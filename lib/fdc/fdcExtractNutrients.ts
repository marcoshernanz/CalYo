import { Doc } from "@/convex/_generated/dataModel";
import { FoodItem } from "@/scripts/importFdcData";

const nutrientIdMap: Record<number, string> = {
  1002: "nitrogen",
  1003: "protein",
  1004: "totalLipidFat",
  1005: "carbohydrateByDifference",
  1007: "ash",
  1008: "energy",
  1009: "starch",
  1010: "sucrose",
  1011: "glucose",
  1012: "fructose",
  1013: "lactose",
  1014: "maltose",
  1018: "alcoholEthyl",
  1024: "specificGravity",
  1032: "citricAcid",
  1039: "malicAcid",
  1041: "oxalicAcid",
  1043: "pyruvicAcid",
  1044: "quinicAcid",
  1050: "carbohydrateBySummation",
  1051: "water",
  1057: "caffeine",
  1058: "theobromine",
  1062: "energy",
  1063: "sugarsTotal",
  1071: "resistantStarch",
  1075: "galactose",
  1076: "raffinose",
  1077: "stachyose",
  1079: "fiberTotalDietary",
  1082: "fiberSoluble",
  1084: "fiberInsoluble",
  1085: "totalFatNlea",
  1087: "calciumCa",
  1089: "ironFe",
  1090: "magnesiumMg",
  1091: "phosphorusP",
  1092: "potassiumK",
  1093: "sodiumNa",
  1094: "sulfurS",
  1095: "zincZn",
  1097: "cobaltCo",
  1098: "copperCu",
  1099: "fluorideF",
  1100: "iodineI",
  1101: "manganeseMn",
  1102: "molybdenumMo",
  1103: "seleniumSe",
  1104: "vitaminAIu",
  1105: "retinol",
  1106: "vitaminARae",
  1107: "caroteneBeta",
  1108: "caroteneAlpha",
  1109: "vitaminEAlphaTocopherol",
  1110: "vitaminDD2D3InternationalUnits",
  1111: "vitaminD2Ergocalciferol",
  1112: "vitaminD3Cholecalciferol",
  1113: "25Hydroxycholecalciferol",
  1114: "vitaminDD2D3",
  1116: "phytoene",
  1117: "phytofluene",
  1118: "caroteneGamma",
  1119: "zeaxanthin",
  1120: "cryptoxanthinBeta",
  1121: "lutein",
  1122: "lycopene",
  1123: "luteinZeaxanthin",
  1125: "tocopherolBeta",
  1126: "tocopherolGamma",
  1127: "tocopherolDelta",
  1128: "tocotrienolAlpha",
  1129: "tocotrienolBeta",
  1130: "tocotrienolGamma",
  1131: "tocotrienolDelta",
  1137: "boronB",
  1146: "nickelNi",
  1159: "cisBetaCarotene",
  1160: "cisLycopene",
  1161: "cisLuteinZeaxanthin",
  1162: "vitaminCTotalAscorbicAcid",
  1165: "thiamin",
  1166: "riboflavin",
  1167: "niacin",
  1170: "pantothenicAcid",
  1175: "vitaminB6",
  1176: "biotin",
  1177: "folateTotal",
  1178: "vitaminB12",
  1180: "cholineTotal",
  1183: "vitaminKMenaquinone4",
  1184: "vitaminKDihydrophylloquinone",
  1185: "vitaminKPhylloquinone",
  1186: "folicAcid",
  1187: "folateFood",
  1188: "5MethylTetrahydrofolate5Mthf",
  1190: "folateDfe",
  1191: "10FormylFolicAcid10hcofa",
  1192: "5FormyltetrahydrofolicAcid5Hcoh4",
  1194: "cholineFree",
  1195: "cholineFromPhosphocholine",
  1196: "cholineFromPhosphotidylCholine",
  1197: "cholineFromGlycerophosphocholine",
  1198: "betaine",
  1199: "cholineFromSphingomyelin",
  1210: "tryptophan",
  1211: "threonine",
  1212: "isoleucine",
  1213: "leucine",
  1214: "lysine",
  1215: "methionine",
  1216: "cystine",
  1217: "phenylalanine",
  1218: "tyrosine",
  1219: "valine",
  1220: "arginine",
  1221: "histidine",
  1222: "alanine",
  1223: "asparticAcid",
  1224: "glutamicAcid",
  1225: "glycine",
  1226: "proline",
  1227: "serine",
  1228: "hydroxyproline",
  1232: "cysteine",
  1242: "vitaminEAdded",
  1246: "vitaminB12Added",
  1253: "cholesterol",
  1257: "fattyAcidsTotalTrans",
  1258: "fattyAcidsTotalSaturated",
  1259: "sfa40",
  1260: "sfa60",
  1261: "sfa80",
  1262: "sfa100",
  1263: "sfa120",
  1264: "sfa140",
  1265: "sfa160",
  1266: "sfa180",
  1267: "sfa200",
  1268: "mufa181",
  1269: "pufa182",
  1270: "pufa183",
  1271: "pufa204",
  1272: "pufa226N3Dha",
  1273: "sfa220",
  1274: "mufa141",
  1275: "mufa161",
  1276: "pufa184",
  1277: "mufa201",
  1278: "pufa205N3Epa",
  1279: "mufa221",
  1280: "pufa225N3Dpa",
  1281: "tfa141T",
  1283: "phytosterols",
  1284: "ergosterol",
  1285: "stigmasterol",
  1286: "campesterol",
  1287: "brassicasterol",
  1288: "betaSitosterol",
  1289: "campestanol",
  1292: "fattyAcidsTotalMonounsaturated",
  1293: "fattyAcidsTotalPolyunsaturated",
  1294: "betaSitostanol",
  1296: "delta5Avenasterol",
  1298: "phytosterolsOther",
  1299: "sfa150",
  1300: "sfa170",
  1301: "sfa240",
  1303: "tfa161T",
  1304: "tfa181T",
  1305: "tfa221T",
  1306: "tfa182TNotFurtherDefined",
  1307: "pufa182I",
  1310: "tfa182TT",
  1311: "pufa182Clas",
  1312: "mufa241C",
  1313: "pufa202N6CC",
  1314: "mufa161C",
  1315: "mufa181C",
  1316: "pufa182N6CC",
  1317: "mufa221C",
  1321: "pufa183N6CCC",
  1323: "mufa171",
  1325: "pufa203",
  1329: "fattyAcidsTotalTransMonoenoic",
  1330: "fattyAcidsTotalTransDienoic",
  1331: "fattyAcidsTotalTransPolyenoic",
  1332: "sfa130",
  1333: "mufa151",
  1334: "pufa222",
  1335: "sfa110",
  1340: "daidzein",
  1341: "genistein",
  1404: "pufa183N3CCCAla",
  1405: "pufa203N3",
  1406: "pufa203N6",
  1408: "pufa204N6",
  1409: "pufa183i",
  1410: "pufa215",
  1411: "pufa224",
  1412: "mufa18111T181tN7",
  1414: "pufa203N9",
  2000: "totalSugars",
  2003: "sfa50",
  2004: "sfa70",
  2005: "sfa90",
  2006: "sfa210",
  2007: "sfa230",
  2008: "mufa121",
  2009: "mufa141C",
  2010: "mufa171C",
  2012: "mufa201C",
  2013: "tfa201T",
  2014: "mufa221N9",
  2015: "mufa221N11",
  2016: "pufa182C",
  2017: "tfa182T",
  2018: "pufa183C",
  2019: "tfa183T",
  2020: "pufa203C",
  2021: "pufa223",
  2022: "pufa204c",
  2023: "pufa205c",
  2024: "pufa225C",
  2025: "pufa226C",
  2026: "pufa202C",
  2028: "transBetaCarotene",
  2029: "transLycopene",
  2032: "cryptoxanthinAlpha",
  2033: "totalDietaryFiberAoac201125",
  2038: "highMolecularWeightDietaryFiberHmwdf",
  2047: "energyAtwaterGeneralFactors",
  2048: "energyAtwaterSpecificFactors",
  2049: "daidzin",
  2050: "genistin",
  2051: "glycitin",
  2052: "delta7Stigmastenol",
  2053: "stigmastadiene",
  2057: "ergothioneine",
  2058: "betaGlucan",
  2059: "vitaminD4",
  2060: "ergosta7Enol",
  2061: "ergosta722Dienol",
  2062: "ergosta57Dienol",
  2063: "verbascose",
  2065: "lowMolecularWeightDietaryFiberLmwdf",
  2066: "vitaminA",
  2069: "glutathione",
};

export default function fdcExtractNutrients(
  item: FoodItem
): Doc<"foods">["nutrients"] {
  const result: Record<string, number> = {};

  for (const nutrient of item.foodNutrients) {
    const { id, unitName } = nutrient.nutrient;
    const amount = nutrient.amount;

    if (amount === undefined || amount === null) continue;

    const key = nutrientIdMap[id];
    if (!key) continue;

    let value = amount;
    if (unitName === "mg") {
      value = amount / 1000;
    } else if (unitName === "Âµg") {
      value = amount / 1000000;
    }

    result[key] = value;
  }

  return result;
}
